<!DOCTYPE html>
<html lang="es">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <meta charset="UTF-8">
    <title>Plan Cero Colas - Registro de Cita</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
    body {
        background-image: url("/static/img/fondo-celeste.png");
        background-size: cover;          /* Ajusta la imagen a toda la pantalla */
        background-position: center;     /* Centra la imagen */
        background-repeat: no-repeat;    /* No se repite */
        background-attachment: fixed;    /* Fija el fondo (opcional efecto elegante) */
        min-height: 100vh;
        margin: 0;
        display: flex;
        align-items: center;
    }

    .card {
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .form-control, .form-select {
        border-radius: 10px;
    }

    .btn-primary {
        border-radius: 10px;
        padding: 10px;
        font-weight: 600;
    }

    .titulo {
        font-weight: bold;
        color: #0d6efd;
    }
</style>
</head>
<body>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="card p-4">
                <div class="card-body">

                    <div class="text-center">
<div class="text-center">
    <img src="/static/img/logo_cerocolas.png" alt="logo" width="60%">
</div></div><br>
<p class="text-center text-muted mb-4">
    Registro de Solicitud de Cita M√©dica
</p>

{% if messages %}
    {% for message in messages %}
        <script>
            alert("{{ message }}");
        </script>
    {% endfor %}
{% endif %}

                    <form method="POST" action="{% url 'registrar_cita' %}"> 
                        {% csrf_token %}

                        <!-- Tipo Documento -->
                        <div class="mb-3">
                            <label class="form-label"><b>Tipo de Documento:</b></label>
                            <select name="tipo_documento" class="form-select" required>
                                <option value="">Seleccione...</option>
                                <option value="DNI">DNI</option>
                                <option value="CE">Carnet de Extranjer√≠a</option>
                             </select>
                        </div>

                        <!-- N√∫mero Documento -->
                        <div class="mb-3">
                            <label class="form-label"><b>N√∫mero de Documento:</b></label>
                            <input type="text" name="numero_doc" class="form-control" placeholder="Ingrese su n√∫mero de documento" required>
                        </div>

                        <!-- Fecha Nacimiento -->
                        <div class="mb-3">
                            <label class="form-label"><b>Fecha de Nacimiento:</b></label>
                            <input type="date" name="fecha_nacimiento" class="form-control" required>
                        </div>

                        <!-- Establecimiento -->
                        <div class="mb-3">
    <label class="form-label"><b>Establecimiento de Salud:</b></label>
    <select name="establecimiento" class="form-select" required>
        <option value="">Seleccione...</option>
        {% for e in establecimientos %}
            <option value="{{ e.descripcion }}">
                {{ e.descripcion }}
            </option>
        {% endfor %}
    </select>
</div>

                        <!-- UPS -->
                        <div class="mb-3">
    <label class="form-label"><b>UPS:</b></label>
    <select name="ups" id="upsSelect" class="form-select" required>
        <option value="">Seleccione...</option>
        {% for u in ups_lista %}
            <option value="{{ u.codigo }}">
                {{ u.codigo }}
            </option>
        {% endfor %}
    </select>
</div>

                        <!-- Servicio -->
         <div class="mb-3">
    <label class="form-label"><b>Servicio:</b></label>
    <select name="servicio" id="servicioSelect" class="form-select" required>
        <option value="">Seleccione un UPS primero...</option>
    </select>
</div>


  <!-- Correo -->
        <div class="mb-3">
    <label for="correo" class="form-label">
        <b>Correo para ser notificado:</b>
    </label>
    <input 
        type="email" 
        name="correo" 
        id="correo" 
        class="form-control" 
        placeholder="ejemplo@dominio.com"
        >
</div>

                        <!-- Bot√≥n -->
                       <div class="text-center">
    <button type="submit" id="btnRegistrar" class="btn btn-primary">
        <span id="textoBtn">Registrar Cita</span>
        <span id="spinnerBtn" style="display:none;">
            <span class="spinner-border spinner-border-sm"></span>
            Procesando...
        </span>
    </button>
</div>

                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById("upsSelect").addEventListener("change", function() {

    let upsSeleccionado = this.value;
    let servicioSelect = document.getElementById("servicioSelect");

    servicioSelect.innerHTML = '<option>Cargando...</option>';

    fetch(`/api/servicios/?ups=${encodeURIComponent(upsSeleccionado)}`)
        .then(response => {
            if (!response.ok) {
                throw new Error("Error HTTP " + response.status);
            }
            return response.json();
        })
        .then(data => {

            servicioSelect.innerHTML = '<option value="">Seleccione...</option>';

            data.forEach(item => {

                // üëá AQU√ç TOMAMOS EL CAMPO "ups" QUE VIENE DE LA API
                let option = document.createElement("option");
                option.value = item.ups;
                option.textContent = item.ups;

                servicioSelect.appendChild(option);
            });

        })
        .catch(error => {
            console.error("Error:", error);
            servicioSelect.innerHTML = '<option>-</option>';
        });

});
</script>

<script>
document.querySelector("form").addEventListener("submit", function() {

    let btn = document.getElementById("btnRegistrar");
    let texto = document.getElementById("textoBtn");
    let spinner = document.getElementById("spinnerBtn");

    // Desactivar bot√≥n
    btn.disabled = true;

    // Ocultar texto
    texto.style.display = "none";

    // Mostrar spinner
    spinner.style.display = "inline-block";
});
</script>
</body>
</html>